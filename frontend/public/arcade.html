<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Arcade - Play NES/SNES Games</title>
  <link rel="stylesheet" href="arcade-modern.css" />
  <link rel="stylesheet" href="button-styles.css" />
  <script>
    // Authentication check - redirect to homepage if not logged in
    (function() {
      const token = localStorage.getItem('token') || localStorage.getItem('access_token');
      if (!token) {
        alert('Please login first to access the Arcade!');
        window.location.href = '/';
      }
    })();
  </script>
  <style>
  body { background: #000; color: #ffd700; font-family: 'Segoe UI', Arial, sans-serif; margin: 0; }
    .arcade-menu { position: fixed; right: 0; top: 0; width: 320px; height: 100vh; background: #181818ee; border-left: 2px solid #ffd700; display: flex; flex-direction: column; align-items: center; padding-top: 2rem; z-index: 10; }
    .arcade-menu h2 { color: #ffd700; margin-bottom: 1rem; }
    .game-list { width: 90%; }
    .arcade-main { margin-right: 340px; min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    .arcade-canvas-wrap { position: relative; margin-top: 2rem; }
    .arcade-canvas { border: 3px solid #ffd700; border-radius: 12px; background: #000; display: block; }
    .fullscreen-btn { position: absolute; top: 10px; right: 10px; background: #ffd700; color: #111; border: none; border-radius: 6px; padding: 0.5rem 1rem; font-size: 1rem; cursor: pointer; }
    .music-player { margin-top: 2rem; }
    .arcade-error { color: #ff4444; margin-top: 1rem; font-size: 1.1rem; }
  </style>
</head>
<body>
  
  <!-- Mobile Controls -->
  <div class="mobile-controls" style="display: none;">
    <div class="mobile-dropdown-container">
      <button class="mobile-dropdown-toggle" id="games-toggle">
        <span class="dropdown-label">NES & GBA Games</span>
        <span class="dropdown-arrow">‚ñº</span>
      </button>
      <div class="mobile-dropdown-content" id="games-dropdown">
        <div class="mobile-game-section">
          <h3>NES Games</h3>
          <div id="mobile-game-list"></div>
        </div>
        <div class="mobile-game-section">
          <h3>GBA Games</h3>
          <div id="mobile-gba-list"></div>
        </div>
      </div>
    </div>
    
    <!-- Mobile Landscape Tip -->
    <div class="mobile-landscape-tip" id="landscape-tip">
      <span class="rotate-icon">üì±‚Üª</span>
      <span class="tip-text">Turn your phone sideways for better experience!</span>
    </div>
  </div>
  
  <div class="arcade-layout">
    <!-- Desktop Layout -->
    <div class="arcade-col left">
      <h2 class="games-title">NES Games</h2>
      <div class="game-list scrollable" id="game-list"></div>
    </div>
    <div class="arcade-col center">
      <iframe
        id="emulator-frame"
        src="/emulatorjs/indexe.html"
        class="emulator-frame"
        allowfullscreen
        title="EmulatorJS"
      ></iframe>
      <button class="fullscreen-btn" id="fullscreen-btn">Fullscreen</button>
      <button class="home-btn" id="home-btn" onclick="window.location.replace('/')">üè† Home</button>
      <button class="mobile-fullscreen-btn" id="mobile-fullscreen-btn">
        <span class="fullscreen-icon">‚õ∂</span> Fullscreen
      </button>
      <button class="mobile-home-btn" id="mobile-home-btn" onclick="window.location.replace('/')">
        <span class="home-icon">üè†</span> Home
      </button>
      <!-- Exit fullscreen button (hidden by default) - Shows as X in circle -->
      <button class="exit-fullscreen-btn hidden" id="exit-fullscreen-btn" aria-label="Exit Fullscreen"></button>
      <!-- Fullscreen hint for mobile users -->
      <div class="fullscreen-hint hidden" id="fullscreen-hint">
        Double-tap screen to exit fullscreen
      </div>
    </div>
    <div class="arcade-col right">
      <h2 class="games-title">GBA Games</h2>
      <div class="game-list scrollable" id="gba-game-list"></div>
    </div>
  </div>
  <script src="arcade-menu.js"></script>
  <script>
    // Fullscreen functionality for iframe
    document.addEventListener('DOMContentLoaded', function() {
      
      const fullscreenBtn = document.getElementById('fullscreen-btn');
      const mobileFullscreenBtn = document.getElementById('mobile-fullscreen-btn');
      const exitFullscreenBtn = document.getElementById('exit-fullscreen-btn');
      const frame = document.getElementById('emulator-frame');
      
      // Enter fullscreen function
      function enterFullscreen() {
        // Try to lock screen orientation to landscape when entering fullscreen on mobile
        if (screen.orientation && screen.orientation.lock) {
          screen.orientation.lock('landscape').catch(() => {
            // Orientation lock not supported or failed, continue anyway
          });
        }
        
        if (frame.requestFullscreen) {
          frame.requestFullscreen();
        } else if (frame.webkitRequestFullscreen) {
          frame.webkitRequestFullscreen();
        } else if (frame.mozRequestFullScreen) {
          frame.mozRequestFullScreen();
        } else if (frame.msRequestFullscreen) {
          frame.msRequestFullscreen();
        }
      }
      
      // Desktop fullscreen button
      if (fullscreenBtn) {
        fullscreenBtn.onclick = enterFullscreen;
      }
      
      // Mobile fullscreen button
      if (mobileFullscreenBtn) {
        mobileFullscreenBtn.onclick = enterFullscreen;
      }
      
      // Exit fullscreen function
      function exitFullscreen() {
        // Unlock orientation when exiting fullscreen
        if (screen.orientation && screen.orientation.unlock) {
          screen.orientation.unlock();
        }
        if (document.exitFullscreen) {
          document.exitFullscreen();
        } else if (document.webkitExitFullscreen) {
          document.webkitExitFullscreen();
        } else if (document.mozCancelFullScreen) {
          document.mozCancelFullScreen();
        } else if (document.msExitFullscreen) {
          document.msExitFullscreen();
        }
      }
      
      // Exit fullscreen button click
      exitFullscreenBtn.onclick = exitFullscreen;
      
      // Double-tap on emulator to exit fullscreen (mobile friendly)
      let lastTap = 0;
      frame.addEventListener('touchend', function(e) {
        const currentTime = new Date().getTime();
        const tapLength = currentTime - lastTap;
        
        // Check if in fullscreen
        const isFullscreen = document.fullscreenElement || 
                            document.webkitFullscreenElement || 
                            document.mozFullScreenElement || 
                            document.msFullscreenElement;
        
        if (tapLength < 500 && tapLength > 0 && isFullscreen) {
          // Double tap detected while in fullscreen
          exitFullscreen();
          e.preventDefault();
        }
        lastTap = currentTime;
      });
      
      // Listen for fullscreen changes to show/hide exit button
      function handleFullscreenChange() {
        const isFullscreen = document.fullscreenElement || 
                            document.webkitFullscreenElement || 
                            document.mozFullScreenElement || 
                            document.msFullscreenElement;
        
        const fullscreenHint = document.getElementById('fullscreen-hint');
        const isMobile = window.innerWidth <= 768;
        
        if (isFullscreen) {
          exitFullscreenBtn.classList.remove('hidden');
          exitFullscreenBtn.style.display = 'flex';
          
          // Show hint on mobile devices when entering fullscreen
          if (isMobile && fullscreenHint) {
            fullscreenHint.classList.remove('hidden');
            fullscreenHint.style.display = 'block';
            
            // Hide hint after 3 seconds
            setTimeout(() => {
              fullscreenHint.classList.add('hidden');
              fullscreenHint.style.display = 'none';
            }, 3000);
          }
        } else {
          exitFullscreenBtn.classList.add('hidden');
          exitFullscreenBtn.style.display = 'none';
          
          if (fullscreenHint) {
            fullscreenHint.classList.add('hidden');
            fullscreenHint.style.display = 'none';
          }
        }
      }
      
      // Add event listeners for fullscreen change
      document.addEventListener('fullscreenchange', handleFullscreenChange);
      document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
      document.addEventListener('mozfullscreenchange', handleFullscreenChange);
      document.addEventListener('MSFullscreenChange', handleFullscreenChange);
    });
  </script>
</body>
</html>
